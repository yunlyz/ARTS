# [译]现代PHP该有的面貌

- 原文地址：[This is what modern PHP looks like](https://medium.freecodecamp.org/this-is-what-modern-php-looks-like-769192a1320)
- 原文作者：[Felipe Lopes](https://medium.freecodecamp.org/@felipebool)
- 译者：[吕运](https://github.com/yunlyz)

标题真是自命不凡，不是吗？Yeah，就是。虽然我多年来一直在使用PHP，我如何说明这项工作的最佳实践和工具是什么？我不能，但我会这样做。

我看到开发人员使用PHP完成工作的方式发生了真正的变化，通过新版本和改进，语言本身不仅会发生巨大改变你，而且整个生态系统也在发生改变。

新的工具、库、框架和文章都在萌芽，规范的定义使得代码更加优雅和通俗易懂。有些人正在考虑如何使工作（以及你作为开发人员的生活）更高效、更干净、更有趣。

我不是新趋势的最早采用者，实际上，当我确认其背后有一个社区时，我只采用了新工具，而且我认为它会改善我的工作。我一直在做的是尝试按照最佳实践编写我的代码。

因此，我花了很多时间开始使用Composer和PHPUnit之类的东西。大约一年前，或多或少，我对所有那些闪亮的新事物敞开心扉。

首先是PSR，然后是Composer、PHPUnit、Travis-CI、其他几个库和令人惊讶的工具。我现在甚至使用IDE（Vim FTW，但PhpStorm与XDebug集成是一个理想的工作流程）。

## 什么是现代？

网上又很多关于PHP有多糟糕的文章，如果你使用PHP代码，你的生活会变得如何的糟糕，语言是如何的丑陋以及你能想到的其他什么。

如果你使用遗留代码，可能你的生活不会很好；但如果有机会参与一个新项目并且使用所有全新的工具，那么你会看见我所谈论的这个新PHP的。

我每天使用的PHP有几个问题，但是，人们无法关注语言、社区和生态系统发生的变化。前面还有很长的路要走，但在PHP领域，事情已经成熟。

我开始在我工作的公司中为内部API创建SDK，就像一个宠物项目一样，并决定遵从最佳实践。其中大多数我已经在做，但我做了一些事情的方式几乎没有发生改变。这些变化和我去年学到的东西就是这篇文章的主题，我称为现代PHP。

## 让我们从工作流程开始
就像我说的，我是IDE的新手，但这是一见钟情。PHPStorm是一款非常棒的软件。这是我第一个也是唯一的IDE。这是我的第一次尝试，我甚至不需要尝试任何其他的IDE。

与XDebug的集成是完美的，PHP命令空间解析，composer、git的集成，自动补全，代码生成以及代码的重构。我可以继续下去。

我不认为你必须使用IDE，实际上，这完全由个人决定。你应该使用任何适合你的东西-Vim、Atom、Emacs、Bracket、NetBeans、PHPStorm、Eclipse等等。这里有两个重点是生产率和舒服度。你的IDE/文本编辑器在那里为你提供帮助。

然而，对于我，最大的点在于debugger的集成。在大项目中编写代码（实际上小项目也同样需要），你必须使用正规的debugger。让我们忘记var_dump和print_r。你需要在运行时打印变量，分析堆栈跟踪，设置断点。这是事情是很有必要的并且使得开发和重构更加容易。

我甚至都不知道是否还有其他的选项，XDebug由你所需要的任何东西。浪费你几分钟时间，如果你还没有做这件事，花几分钟时间安装Xdebug并且集成到你的IDE或文本编辑器。开始调试你的代码使用正确的工具。

另一个我想引起你注意的工具是Github。另外整篇文章是写Github和Git的优点以及为什么你必须要开始把代码同步到一个版本系统中。但是我想想你展示另外一个原因。

这里的重点是集成。

很少的工具可以集成Github，你应该从现在起使用它们。这些工具可以在你持续集成过程中生成指标，运行测试，运行任务，并且可以做所有已经排序的工作流程。集成是你开始使用Github的一个好理由，所有其他人都受到另一个时刻的影响。

## 依赖管理

在现代PHP生态系统中另一个重要的点是依赖管理，Composer是这项工作的工具。

Composer已有5年历史了，但在我看来，大规范的采用是在几年前。可能因为我不是最新的采用者，或者是因为PHP开发者不情愿去改变。

这个工具为Packagist提供了前端界面，Packagist是一个PHP包仓库，由源码存放在GitHub上（或其他地方，例如bitbucket）的PHP库、项目以及工具组成。

在文章中，我谈到的所有库和你其中一个pet项目都可以通过一个简单的命令添加到你的项目中。
```shell
$ composer require packgae_vendor/package_name
```

如果你不知道关于ackage的vendor，你可以搜索package以查找并正确的安装。
```shell
$ composer search packgae_name
```

如果它仅仅能完成这项工作和依赖管理，Composer是一个伟大的工具，但它不仅如此。花一点时间去安装它并且阅读[文档](https://getcomposer.org/doc/).

## 命令行也可以很好。
我很喜欢通过命令行去尝试一些想法。对我来说，最伟大的REPL工具是[IPython](https://ipython.org/)。它可以自动补全你的代码，轻松定义function，简化了对文档的访问以及另外一些令人惊讶的特性。对我们来说缺点是这个工具是Python而不是PHP。

在PHP的世界，有一种名为“互动模式”的东西可以访问terminal的，只要输入
```shell
$ php -a
Interactive mode enabled
php >
```
在此刻，你已经在互动模式下并且可以开始测试一些事情。有用，但是这个工具太不直观了。我尝试过几次，直到我了解Ipython能做的事情后，我直接放弃了。

我们是幸运的，在block上有个很酷的名为Psysh的工具。Psysh是一个Amazing的工具，各种有趣的特性，通过composer可以被全局安装或在每一个项目中。

对我来说，Psysh最好的特性就是在线文档。查阅一个PHP函数文档而不同在php.net上是很伟大的。缺点就是你需要做一些事情才能完全发挥作用。

安装之后，为了是它正常的工作，我们需要输入一下命令（我用的是Debian，有可能不是对所有人通用的）。
```shell
$ apt-get install php7.1-sqlite3
$ mkdir /usr/local/share/psysh
$ wget http://psysh.org/manual/en/php_manual.sqlite -o /usr/local/share/psysh/php_manual.sqlite
```

第一行命令是非强制性的，如果你已经安装了sqlite可跳过这一步。第2行命令创建用于存储文档的目录，第3行下载并保存文档到先前创建的目录中。请记住，这些命令必须使用ROOT用户运行。

现在，你可以看到下面的输出了。
![](https://cdn-images-1.medium.com/max/2000/1*qT0TK5Uq7BsAsebhLjDjCQ.png)

前往[Psysh](http://psysh.org/)，学习更多关于这个非常棒的工具。

## 你应该开始测试
这是一句我每天对自己说的口头禅。像大多数人一样，我不会严格按照TDD所建议的那样测试我自己的代码。我现在正在接受测试并且已经这么做快大半年了，这是一条很长的路。

这是一个很大的问题，我在另一篇[文章](https://medium.freecodecamp.org/few-thoughts-on-legacy-hell-e229f76529e0)中所讨论过，让我开始给测试 一个机会。

我提出的第一个工具就是[PHPUnit](https://phpunit.de/)，如官方网站所述
```text
PHPUnit是面向程序员的PHP测试框架。
它是用于单元测试框架的xUnit架构的一个实现。
```

因此，PHPUnit是一个可以帮助你在项目中创建测试的框架，单一测试。通过一些方法测试代码的输出以及从测试中生成带有结果的输出。

自从我开始思考、阅读和谈论测试，我发现另一个好用的工具，一个名为Behat的PHP BDD框架，它补充了你在单一测试中所做的工作。

BDD（Behavior-Driven Development）是一个来源于TDD（Test-Driven Development）的开发进程。缩写词不重要，重要的是你可以指定你的测试使用更多的自然语言，一种非技术人员也能理解的语言。

这门语言叫做Gherkin，描述测试中期待的行为。一个使用Gherkin的测试描述，看起来是这样的。
![](https://cdn-images-1.medium.com/max/1600/1*5lUk9W_pS3lnIER7pudLxQ.png)

在这些行的后面有一段PHP代码，只要在该方法的PHPDoc中指定行和正则表达式之间存在匹配，就会调用该代码。这段代码使用你的SDK、应用程序或者web系统实现了这些步骤以及真实用户将执行的操作。

Behat工作流程是如何的平滑。在所有的事情正确配置之后，你可以开始编写所有可能场景去测试一个特性。第一次运行Behat，会给出所有的方法模版，为了在场景中实现每一个步骤，你应该把模块添加到你的PHP上下文中。

之后，你开始编写真正的代码用于每一步和保持循环。

- 为步骤实现PHP代码
- 运行测试
- 如果每一件事都是好的，为另一个步骤编写PHP代码
- 如果发生一些意义，修复它

经过半小时的配置和阅读文档，你准备使用Behat，你将会咋最后看见所有的PHP代码和你已经知道如何去编写它。

## 持续集成
持续集成（CI）是一种程序，一直在做着某些事情，为软件工程师部署软件的事情。

简单的说，它是将小块代码不断地（可能一天几次）整合到代码库中的行为。代码将被测试以及不会中断任何事情。CI帮助你自动化构建、测试和部署你的应用程序。

通过Travis CI可以通过少量的点击就能集成你的Github项目，每次push都会运行你使用PHPUnit和Behat创建的测试，通知你上一次实现的特性是否准备好以及是否被合并。除此之外，你还可以使用Travis CI部署你的代码带生产环境和分期。

拥有良好定义的流程的良好工作流程是非常棒，Travis CI可以帮助你做这件事。从[这里](https://docs.travis-ci.com/user/getting-started/)开始，发现考虑软件开发流程是多么有趣的一件事，而不仅仅是代码本省。

## 坚持PSR-1和PSR-2
如果你不知道什么是PSR，那么你应该要去了解。实际上，PSR代表PHP Standard Recommendations，PHP-FIG（PHP Framework Interop Group）建议，由最大的PHP项目，框架和CSM成员组成的联盟，他们正在思考语言，生态系统的未来以及讨论要遵循的标准。

很长一段时间，PHP没有编码标准。我不是那么的老，但我每次看到别人的项目或者库，它们都遵从不同的规范。有时支架留在一个位置，有时它被放在另一个地方，不同的方法被用来处理长线以及你能想到的每种其他的风格和偏好的组合，这是一团糟。

PHP-FIG做了许多的工作，但通过提出一个统一的代码，他们说“让我们不再担心代码风格，让每个都遵循标准，开始考虑编写出色的软件”。现在，每当你查看别人的代码，你仅需要关注代码是如何工作的，不再归咎于格式和结构。

直到这篇文章最后，9个公认的PSR为常见问题提出了共同的解决方案。但是如果你不再任何关于PSR标准，从[PSR-1](http://www.php-fig.org/psr/psr-1/)和[PSR-2](http://www.php-fig.org/psr/psr-2/)开始。

这些标准提出了现代PHP编码风格。确保你在使用之前阅读文档。不要认为你能在编码的时候完全记住他们，这是一个过程。但为了让你确定，他们是有用的工具。

[PHP CodeSniffer](https://packagist.org/packages/squizlabs/php_codesniffer)是一个可以在Packagist找到并通过Composer安装的工具。不认为仓库的名字是最好的选择，因为它提供了两种不同的工具，phpcs和phpcbf。

Phpcs是Code sniffer，它会扫描你的整个代码，寻找不遵循代码标准配置的部分。

你可以使用phpcs的几种代码标准，甚至你可以创建自己的标准。代码扫描完成之后，phpcs会向你展示不遵循标准的代码列表。太棒了。

现在，如何改变那些错误的事情？你打开每一个文件，修改代码，重新运行phpcs，错误不再出现，并重复该过程。他将十分的无聊。

为了解决这个问题，PHP CodeSniffer开发了一个另外的工具，名叫phpcbf或PHP code beautifies。运行phpcbf，按照相同的规则设置，瞧，它会自动为你修复这些问题，或者它试图在不破坏你的代码情况下尽力而为。

尝试养成在提交任何改变的代码到仓库之前运行phpcs和phpcbf的习惯，这样可以确保你的代码遵循标准规范，并且如果某人喜欢你的工具或者项目并且想要贡献代码，那么阅读他们就没问题了。

## 框架
我不再花太多时间去讨论框架，那里有好几个，每一个可能好或坏。个人经验，我不太愿意去使用那些包含了任何事情在里面的大框架。我喜欢你必须使用你需要的东西的想法。

如果你需要HTTP客户端，请使用[Guzzle]()。如果你需要模版引擎，请使用Twig。如果你需要一个路由，找一个好的、适合你的组件去使用它。组合这些组件创建你的应用。

(Symfony)[https://symfony.com/]在这个概念上做的很好。你可以在项目中使用整个框架，也可以使用你想用的去使用它。就是如此简单。

然而，每当我需要一个框架去写一个应用的时候，我选择一个叫微服务的框架。他们非常小，只提供基本知识，易于定制，更容易是他们遵循你的项目架构。

我选择的是(Slimframework)[https://www.slimframework.com/]，我认为你应该去阅读它。使得开发小项目很简单，但相对较大的那些，它会变得更复杂一些。

顺便说一句，对于那些从编程开始的人来说，我真的认为在采用框架并为此而死之前，你应该尝试创建自己的框架。这将使你了解整个机制并简化大型机制的采用。

## 现代化PHP工具列表
让我们用链接列表结束这篇文章，对我来说，这些组件、工具以及库很好的展现了什么是现代PHP：

- [Slimframework](https://www.slimframework.com/) 一个很好何苦很酷的微型框架
- [Symfony](http://symfony.com/) 一个充满了伟大和可重用组件的大框架
- [Guzzle](http://docs.guzzlephp.org/en/stable/) 一个简单易用的HTTP客户端
- [PHPUnit](https://phpunit.de/) 单元测试框架
- [Behat](http://behat.org/en/latest/) BDD框架
- [PHPCS/CBF](https://github.com/squizlabs/PHP_CodeSniffer) 代码嗅探器和代码美化器
- [Faker](https://github.com/fzaninotto/Faker) 假数据生成器
- [Psysh](http://psysh.org/) 一个充满令人惊讶特性的运行时终端
- [Composer](https://getcomposer.org/) 依赖管理和其他有用的功能
- [Packagist](https://packagist.org/) 包存储库
- [Twig](https://twig.symfony.com/) 模版引擎

文章标题真的是自命不凡，我知道。我真正想展示的是PHP正在发展，生态系统在以相同（可能更快）的速度发展。